---
// This route serves the same content as /admin but allows the URL to reflect the current view
// The React client will read the URL and show the appropriate view
import AdminLayout from "@/layouts/admin.layout.astro";
import AppWrapper from "@/components/admin/AppWrapper";
import { capsuloConfig } from "@/lib/config";
import { loadGlobalData } from "@/lib/cms-loader";
import { getAvailablePages } from "@/lib/admin-page-loader";
import componentManifest from "virtual:component-manifest";

const GITHUB_OWNER = capsuloConfig.github.owner;
const GITHUB_REPO = capsuloConfig.github.repo;

// Get all page files from the pages directory, excluding admin subdirectory
const pageFiles = import.meta.glob("../../**/*.astro", { eager: true });

// Get available pages (metadata only, no data - data will be loaded lazily in the client)
const availablePages = getAvailablePages(pageFiles);

// Load global variables data (this is small and needed for the globals view)
let globalData: { variables: any[] } = { variables: [] };
try {
  const loadedGlobalData = await loadGlobalData();
  if (loadedGlobalData) {
    globalData = loadedGlobalData;
  }
} catch (error) {
  console.error("Error loading global variables data:", error);
  globalData = { variables: [] };
}

const content = {
  title: "TESTUI - Admin - Pages",
};
---

<AdminLayout content={content}>
  <AppWrapper
    client:load
    availablePages={availablePages}
    globalData={globalData}
    componentManifest={componentManifest}
    githubOwner={GITHUB_OWNER}
    githubRepo={GITHUB_REPO}
  />
</AdminLayout>
