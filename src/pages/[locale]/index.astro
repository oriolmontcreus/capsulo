---
import Hero from "@/components/capsulo/hero/Hero.astro";
import Layout from "@/layouts/main.astro";
import { loadPageData, getComponentDataByKey } from "@/lib/cms-loader";
import { LOCALES, isValidLocale } from "@/lib/i18n-utils";

export async function getStaticPaths() {
    return LOCALES.map((locale) => ({
        params: { locale },
    }));
}

// Get locale from params
const { locale } = Astro.params;
if (!locale || !isValidLocale(locale)) return Astro.redirect("/");

// Load CMS data - the loader will automatically handle locale extraction
const pageData = await loadPageData("index");

// Single instance: Get first hero component (hero-0)
// If you have multiple heroes, use index parameter: getComponentDataByKey(pageData, "hero", locale, 1) for second instance
const heroData = getComponentDataByKey(pageData, "hero", locale, 0);

// Multi-instance example (commented out):
// import { getAllComponentsByKey } from "@/lib/cms-loader";
// const heroes = getAllComponentsByKey(pageData, "hero", locale);
// Then in template: {heroes?.map((data, i) => <Hero key={i} {...data} />)}
console.log("Loaded hero data:", heroData);
---

<Layout content={{ title: "TESTUI" }}>
    <Hero {...heroData} />
</Layout>
